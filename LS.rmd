---
title: "LS"
author: "Yaochen Zhu"
date: "April 4, 2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(dplyr)
```


```{r}
senti <- read.csv("~/GitHub/CVEngineer_Bootcamp/sentiment_sentence.csv")
char <- read.csv("~/GitHub/CVEngineer_Bootcamp/character_sentence.csv")
ends <- read.csv("~/GitHub/CVEngineer_Bootcamp/chapter_ends.csv")
```


```{r}
senti_invest = senti[2,-1] # anger
#senti_compound[,darcy_app]
```

```{r}
x = seq(-10, 10, by = 1)
y = 10*dnorm(x, mean = 0, sd = 1)

kernel <- function(id, one_d_data = senti_invest, weight = y, window = 21){
  smooth = 0
  if (id >= (window-1)/2 & id <= (dim(one_d_data)[2] - (window-1)/2)){
    smooth = sum(weight * one_d_data[1,(id-(window-1)/2):(id+(window-1)/2)])
  } else if (id < (window-1)/2) {
    smooth = sum(weight[((window+1)/2-id):window] * one_d_data[1,1:(id+(window-1)/2)])
  } else {
    length  = (window+1)/2 + dim(one_d_data)[2]-id
    smooth = sum(weight[1:length] * one_d_data[1,id-((window-1)/2):id-((window-1)/2)+length-1])
  }
  return(smooth)
}

```


```{r}
library(matlib)

contribution = matrix(0L, nrow = dim(char[,-1])[1], ncol = dim(char[,-1])[2])

for (i in 1:dim(char)[1]){
  
char_app = which(char[i,-1] == 1)

contribution[i, char_app] = sapply(char_app, kernel)

}

# contribution 14*5584


library(glmnet)

# ridge regression

range_invest = ends[c((1),(10+1)),2] # FROM where to where
lambdas <- 10^seq(2, -3, by = -.1)
alpha_choice = c(0,1)

y = t(data.matrix(senti_invest))[range_invest[1]:range_invest[2]]
X = t(contribution[,range_invest[1]:range_invest[2]])


cv_ridge <- cv.glmnet(X, y, alpha = alpha_choice[1], lambda = lambdas)
optimal_lambda <- cv_ridge$lambda.min
optimal_lambda

ridge_reg = glmnet(X,y, alpha = alpha_choice[1], family = 'gaussian', lambda = optimal_lambda)


beta = as.vector(ridge_reg[["beta"]])
beta = beta/norm(beta, type='2')

plot(1:14, beta, xlim = c(0,14), main = 'overall negative sentiment contribution')
text(1:14, beta, char[,1], cex=0.6, pos=2, col="blue")
```



```{r}
library(tidyverse)
```


